import subprocess
import datetime
import threading
import time
import sys

def spinner():
    while not stop_spinner:
        for cursor in '|/-\\':
            sys.stdout.write(cursor)
            sys.stdout.flush()
            time.sleep(0.1)
            sys.stdout.write('\b')

def run_nmap_scan(target, scan_type):
    scan_commands = {
        '1': f"nmap -T4 -F {target}",
        '2': f"nmap -sV {target}",
        '3': f"nmap -O {target}",
        '4': f"nmap -A {target}",
        '5': f"nmap --script vuln {target}"
    }

    command = scan_commands.get(scan_type)
    if not command:
        print("Invalid scan type selected.")
        return

    print(f"\nRunning: {command}")
    print("Scanning... ", end='', flush=True)

    global stop_spinner
    stop_spinner = False
    spinner_thread = threading.Thread(target=spinner)
    spinner_thread.start()

    try:
        result = subprocess.run(command, shell=True, capture_output=True, text=True)
        output = result.stdout
    finally:
        stop_spinner = True
        spinner_thread.join()
        print("\nScan complete!\n")

    print(output)

    timestamp = datetime.datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
    file_name = f"scan_result_{target.replace('.', '_')}_{timestamp}.txt"
    with open(file_name, "w") as file:
        file.write(output)

    print(f"\nâœ… Report saved as: {file_name}\n")

if __name__ == "__main__":
    print("===== Simple Vulnerability Scanner with Progress Spinner =====")
    target = input("Enter the IP address or domain to scan: ")
    print("""
    Select Scan Type:
    1. Quick Scan
    2. Version Detection
    3. OS Detection
    4. Aggressive Scan
    5. Vulnerability Scan
    """)
    scan_type = input("Enter the scan type number (1-5): ")
    run_nmap_scan(target, scan_type)
